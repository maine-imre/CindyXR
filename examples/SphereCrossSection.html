<!DOCTYPE html>
<html>

<head>
<title>SphereCrossSection</title>
<meta charset="UTF-8">
    <script type="text/javascript" src="https://raw.githubusercontent.com/CindyJS/deploy/snapshot/Cindy.js"></script>
    <script type="text/javascript" src="https://raw.githubusercontent.com/CindyJS/deploy/snapshot/Cindy3D.js"></script>
    <script type="text/javascript" src="https://raw.githubusercontent.com/CindyJS/deploy/snapshot/CindyXR.js"></script>
<script id="csinit" type="text/x-cindyscript">

    initxrcindy3d(referencemode->"unbounded");
    
    //setup controller
	xrControllers =  getxrinputsources();
    
    size3d(.5); //default size.
    
	circlePar(w, basis0, basis1, center, radius) := (radius*(sin(w)*basis1+cos(w)*basis0) + center);  //parameterized fn for circle
    
    drawCircle(center, radius, basis0, basis1) := (
    	repeat(n,i,
	    	w1 = i/n*360;
	    	w2 = (i+1)/n*360;
	    	draw3d(radius*circlePar(w1, basis0, basis1, center, radius),radius*circlePar(w2, basis0, basis1, center, radius)); //draw circle as a set of line segments
    	);
    );
    
    crossSectSphere(sCenter, sRadius, pPos, pNorm) := (
    		pNorm = pNorm / |pNorm|;
			center = (pPos-sCenter)*pNorm + sCenter;
    		radius = re(sqrt(sRadius^2+|center-sCenter|^2));
    		
    		//need to define the basis with crossproduct
    		basis0 = cross(pNorm,[1,0,0]);
    		if(|basis0| == 0)
    			basis0 = cross(pNorm,[0,1,0]);
			else
				basis0 = basis0/|basis0|;
			basis1 = cross(pNorm,basis0);

			drawCircle(center, radius, basis0, basis1);
    );
    
    //Sphere Crossection Parameters
    	sphereCenter = [0,0,0];
    	sphereRadius = 1;
    	crossSectPlanePos = xrControllers[0].filteredTransform.position;
    	crossSectPlaneNorm = [1,0,0]*xrControllers[0].filteredTransform.orientation;

    xrrenderfunction() := (
		begin3d();
			crossSectSphere(sphereCenter, sphereRadius, crossSectPlanePos, crossSectPlaneNorm);
		end3d();
    );
    xr(xrrenderfunction());
</script>

<script type="text/javascript">
    var cdy = CindyJS({
        scripts: "cs*",
        angleUnit: "Â°",
        exclusive: "true",
        ports: [
            {id: "CSCanvas", transform: [{visibleRect: [-5, -5, 5, 5]}], background: "rgb(200,176,192)"}
        ],
        csconsole: false,
        use: [
            "Cindy3D", "CindyXR"
        ],
        autoplay: false,
        behavior: []
    });
</script>
</head>

<body>
    <canvas id="Cindy3D" style="border: none;" width="1000" height="1000"></canvas>
    <div id="CSCanvas" style="width:50px; height:50px; border:none"></div>
</body>

</html>

