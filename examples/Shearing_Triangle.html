<!DOCTYPE html>
<html>

<head>
<title>Shearing Triangle DEMO</title>
<meta charset="UTF-8">
    <script type="text/javascript" src="../deploy/Cindy.js"></script>
    <script type="text/javascript" src="../deploy/Cindy3D.js"></script>
    <script type="text/javascript" src="../deploy/CindyXR.js"></script>
<script id="csinit" type="text/x-cindyscript">

    initxrcindy3d(referencemode->"local");

    xrrenderfunction() := (
		begin3d();

	   //setup controller - 1 indexed
	    xrControllers =  getxrinputsources();
        //grab the first available controller
        inputsource = xrControllers_1;
        //reads the position in homogeneous coordinates
        //homogeneous coordinates end in 1 if tracked, zero if not tracked
        position = inputsource.gripSpaceTransform.position;

        size3d(.1);

		//set bg color
			background3d([.9,.9,.9]);
			
		//store point values as vectors
		//note that this should eventually be switched over to cindy3d geometry
			a=[1,0,0,1];
			b=[0,0,0,1];
			cDefault = [0,1,0,1];
			if(take(position,4) == 0, position = cDefault);

            //c uses a projection of the controller's last good position onto the line ab;
			abHat = (a-b)/|a-b|;
			c = ((position-cDefault)*abHat)*abHat + cDefault;


		//draw parallel lines
			draw3d((a-b)*100+a,(a-b)*(-100)+a,size->.1, color->[.7,.7,.7]); //line through ab
			draw3d((a-b)*100+c,(a-b)*(-100)+c,size->.1, color->[.7,.7,.7]); //line through c parallel to ab

		//draw line segments ab, bc, ac
			draw3d(a,b, color->[0,0,0]);
			draw3d(b,c, color->[0,0,0]);
			draw3d(a,c, color->[0,0,0]);

		//draw points abc
			draw3d(a, size->.3, color->[1,0,0]);
			draw3d(b, size->.3, color->[0,1,0]);
			draw3d(c, size->.3, color->[0,0,1]);
			draw3d(c, size->.3, color->[0,0,1]);


		//draw triangle abc
			fillpoly3d([a,b,c], color->[.9,.9,.9]);
		end3d();
    );
    xr(xrrenderfunction());
</script>

<script type="text/javascript">
    var cdy = CindyJS({
        scripts: "cs*",
        angleUnit: "Â°",
        exclusive: "true",
        ports: [
            {id: "CSCanvas", background: "rgb(200,176,192)"}
        ],
        csconsole: false,
        use: [
            "Cindy3D", "CindyXR"
        ],
        autoplay: false,
        behavior: []
    });
</script>
</head>

<body>
    <canvas id="Cindy3D" style="border: none;" width="700" height="700"></canvas>
    <div id="CSCanvas" style="width:50px; height:50px; border:none"></div>
</body>

</html>
